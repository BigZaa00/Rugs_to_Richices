<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>$LOTTO: 12:17 Forex Frenzy</title>
  <style>
    body {
      background: #1e222d;
      color: #d3d4d5;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    #login-screen {
      margin-top: 20vh;
      text-align: center;
    }
    #login-screen h1 {
      color: #00ff00;
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    #login-screen p {
      font-size: 1.2em;
      margin-bottom: 20px;
    }
    #game-screen {
      display: none;
      width: 100%;
      max-width: 1200px;
      margin: 20px;
      display: flex;
      flex-direction: row;
    }
    #chart-container {
      flex: 3;
      background: #252a3a;
      border-radius: 8px;
      padding: 10px;
      position: relative;
    }
    #ticker {
      background: #1a1e2a;
      padding: 8px;
      font-size: 1em;
      white-space: nowrap;
      overflow: hidden;
      animation: scroll 15s linear infinite;
      border-bottom: 1px solid #3a3f4f;
    }
    @keyframes scroll {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    #sidebar {
      flex: 1;
      background: #252a3a;
      border-radius: 8px;
      padding: 15px;
      margin-left: 10px;
      text-align: left;
    }
    #sidebar h2 {
      color: #00ff00;
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    #sidebar p {
      margin: 8px 0;
      font-size: 0.9em;
    }
    canvas {
      width: 100%;
      height: 200px;
      background: #1e222d;
      margin-bottom: 10px;
    }
    button {
      background: #00ff00;
      color: #000;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
      margin: 5px 0;
      width: 100%;
    }
    button:hover {
      background: #00cc00;
    }
    .tooltip {
      position: absolute;
      background: #3a3f4f;
      color: #d3d4d5;
      padding: 5px;
      border-radius: 4px;
      font-size: 0.8em;
      display: none;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="login-screen">
    <h1>$LOTTO: 12:17 Forex Frenzy</h1>
    <p>Connect your Phantom wallet to trade forex markets, indices, and buy lottery tickets for the 12.17 SOL draw!</p>
    <button onclick="connectWallet()">Connect Phantom Wallet</button>
  </div>
  <div id="game-screen">
    <div id="chart-container">
      <div id="ticker">$LOTTO News: Buy tickets for the 12.17 SOL draw on June 21, 2026! | Prize Pool: 12.17 SOL</div>
      <canvas id="lotto-chart"></canvas>
      <canvas id="solusd-chart"></canvas>
      <canvas id="memeindex-chart"></canvas>
      <div class="tooltip" id="tooltip"></div>
    </div>
    <div id="sidebar">
      <h2>$LOTTO Lottery</h2>
      <p>Next Draw: <span id="draw-date">June 21, 2026</span></p>
      <p>Ticket Price: <span id="ticket-price">0.1 SOL</span></p>
      <p>Prize Pool: <span id="prize-pool">12.17 SOL</span></p>
      <p>Tickets Owned: <span id="tickets-owned">0</span></p>
      <h2>Market Data</h2>
      <p>$LOTTO Price: <span id="token-price">0 SOL</span></p>
      <p>SOL/USD: <span id="solusd-price">150.00</span></p>
      <p>Meme Index: <span id="memeindex-price">1000.00</span></p>
      <p>Portfolio Value: <span id="portfolio-value">0 SOL</span></p>
      <p>Wallet: <span id="wallet-address">Not connected</span></p>
      <p>SOL Balance: <span id="sol-balance">0</span></p>
      <button onclick="buyTicket()">Buy Lottery Ticket (0.1 SOL)</button>
      <button onclick="tradeAsset('buy')">Buy Meme Stock (Mock)</button>
      <button onclick="tradeAsset('sell')">Sell Meme Stock (Mock)</button>
      <a href="https://pump.fun" target="_blank"><button>Buy $LOTTO</button></a>
    </div>
  </div>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
  <script>
    let walletConnected = false;
    let walletPublicKey = null;
    let solBalance = 0;
    let ticketCount = 0; // Mock: track tickets off-chain
    let prizePool = 12.17; // Fixed prize pool
    let tokenPrice = 0.000001; // Mock: $LOTTO price
    let solUsdPrice = 150.00; // Mock: SOL/USD forex pair
    let memeIndexPrice = 1000.00; // Mock: Meme Index
    let portfolio = { lotto: 0, solusd: 0, memeindex: 0 }; // Mock portfolio
    let lottoHistory = Array(10).fill(0.000001);
    let solUsdHistory = Array(10).fill(150.00);
    let memeIndexHistory = Array(10).fill(1000.00);
    const DRAW_DATE = new Date('2026-06-21T00:00:00Z');
    const newsEvents = [
      'Meme Fed raises rates, SOL/USD dips!',
      'Hedge Fund Bot pumps $LOTTO!',
      'Crypto Index surges on NPC hype!',
      'Meme Index crashes, traders panic!'
    ];
    const disasters = ['Hurricane', 'Flash Crash', 'NPC Hack', 'Market Freeze'];

    // NPC-driven market updates
    function updateMarket() {
      // NPC Meme Fed: Randomly adjust prices
      tokenPrice *= (1 + (Math.random() - 0.5) * 0.1); // $LOTTO volatility
      solUsdPrice *= (1 + (Math.random() - 0.5) * 0.05); // SOL/USD volatility
      memeIndexPrice *= (1 + (Math.random() - 0.5) * 0.03); // Meme Index volatility

      // Rug pulls (5% chance for $LOTTO or index)
      if (Math.random() < 0.05) {
        tokenPrice *= 0.1; // NPC-driven rug pull
        lottoHistory.fill(tokenPrice); // Reset history
      }
      if (Math.random() < 0.05) {
        memeIndexPrice *= 0.1; // NPC-driven index crash
        memeIndexHistory.fill(memeIndexPrice);
      }

      // Update histories
      lottoHistory.push(tokenPrice);
      solUsdHistory.push(solUsdPrice);
      memeIndexHistory.push(memeIndexPrice);
      if (lottoHistory.length > 10) lottoHistory.shift();
      if (solUsdHistory.length > 10) solUsdHistory.shift();
      if (memeIndexHistory.length > 10) memeIndexHistory.shift();
    }

    // Update ticker, charts, and portfolio
    function updateTicker() {
      if (!walletConnected) return;
      updateMarket();
      const now = new Date();
      const timeLeft = DRAW_DATE - now;
      const daysLeft = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
      let tickerText = `$LOTTO News: ${daysLeft} days until 12.17 SOL draw! | Prize Pool: ${prizePool.toFixed(2)} SOL`;

      // Forex Factory-style news (10% chance)
      if (Math.random() < 0.1) {
        tickerText = newsEvents[Math.floor(Math.random() * newsEvents.length)];
      }

      // AI-driven disasters (2% chance)
      if (Math.random() < 0.02) {
        const disaster = disasters[Math.floor(Math.random() * disasters.length)];
        tickerText = `DISASTER: ${disaster} hits markets! Prize pool secure at ${prizePool.toFixed(2)} SOL!`;
        tokenPrice *= 0.8; // Disaster impact
        solUsdPrice *= 0.9;
        memeIndexPrice *= 0.85;
      }

      document.getElementById('ticker').textContent = tickerText;
      document.getElementById('draw-date').textContent = `June 21, 2026 (${daysLeft} days left)`;
      document.getElementById('prize-pool').textContent = `${prizePool.toFixed(2)} SOL`;
      document.getElementById('tickets-owned').textContent = ticketCount;
      document.getElementById('token-price').textContent = `${tokenPrice.toFixed(6)} SOL`;
      document.getElementById('solusd-price').textContent = `${solUsdPrice.toFixed(2)} USD`;
      document.getElementById('memeindex-price').textContent = `${memeIndexPrice.toFixed(2)}`;
      document.getElementById('portfolio-value').textContent = (
        portfolio.lotto * tokenPrice +
        portfolio.solusd * solUsdPrice / 100 +
        portfolio.memeindex * memeIndexPrice / 1000
      ).toFixed(4);

      drawCharts();
      setTimeout(updateTicker, 5000);
    }

    // Draw candlestick charts
    function drawCharts() {
      const charts = [
        { canvasId: 'lotto-chart', history: lottoHistory, label: '$LOTTO' },
        { canvasId: 'solusd-chart', history: solUsdHistory, label: 'SOL/USD' },
        { canvasId: 'memeindex-chart', history: memeIndexHistory, label: 'Meme Index' }
      ];

      charts.forEach(chart => {
        const canvas = document.getElementById(chart.canvasId);
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const maxPrice = Math.max(...chart.history);
        const minPrice = Math.min(...chart.history);
        const range = maxPrice - minPrice || 0.000001;
        const candleWidth = canvas.width / (chart.history.length * 1.5);
        chart.history.forEach((price, i) => {
          const open = i > 0 ? chart.history[i - 1] : price;
          const close = price;
          const high = Math.max(open, close) * (1 + Math.random() * 0.02);
          const low = Math.min(open, close) * (1 - Math.random() * 0.02);
          const x = i * candleWidth * 1.5 + candleWidth / 2;
          const yHigh = ((maxPrice - high) / range) * canvas.height;
          const yLow = ((maxPrice - low) / range) * canvas.height;
          const yOpen = ((maxPrice - open) / range) * canvas.height;
          const yClose = ((maxPrice - close) / range) * canvas.height;
          ctx.beginPath();
          ctx.moveTo(x, yHigh);
          ctx.lineTo(x, yLow);
          ctx.strokeStyle = '#fff';
          ctx.stroke();
          ctx.fillStyle = close >= open ? '#00ff00' : '#ff0000';
          ctx.fillRect(x - candleWidth / 2, Math.min(yOpen, yClose), candleWidth, Math.abs(yClose - yOpen));
        });

        // Tooltip on hover
        canvas.onmousemove = (e) => {
          const rect = canvas.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const index = Math.floor((x / canvas.width) * chart.history.length);
          if (index >= 0 && index < chart.history.length) {
            const price = chart.history[index];
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = `${chart.label}: ${price.toFixed(6)}`;
            tooltip.style.display = 'block';
            tooltip.style.left = `${e.clientX + 10}px`;
            tooltip.style.top = `${e.clientY + 10}px`;
          }
        };
        canvas.onmouseleave = () => {
          document.getElementById('tooltip').style.display = 'none';
        };
      });
    }

    // Connect Phantom wallet
    async function connectWallet() {
      if (window.solana && window.solana.isPhantom) {
        try {
          const response = await window.solana.connect();
          walletPublicKey = response.publicKey.toString();
          walletConnected = true;
          document.getElementById('wallet-address').textContent = walletPublicKey.slice(0, 4) + '...' + walletPublicKey.slice(-4);
          document.getElementById('login-screen').style.display = 'none';
          document.getElementById('game-screen').style.display = 'flex';
          await updateSolBalance();
          updateTicker();
        } catch (err) {
          alert('Connection failed: ' + err.message);
        }
      } else {
        alert('Please install the Phantom wallet!');
      }
    }

    // Update SOL balance
    async function updateSolBalance() {
      if (walletConnected) {
        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('devnet'));
        const publicKey = new solanaWeb3.PublicKey(walletPublicKey);
        const balance = await connection.getBalance(publicKey);
        solBalance = balance / solanaWeb3.LAMPORTS_PER_SOL;
        document.getElementById('sol-balance').textContent = solBalance.toFixed(4);
      }
    }

    // Buy lottery ticket (mock, actual requires backend)
    async function buyTicket() {
      if (!walletConnected) {
        alert('Connect your Phantom wallet!');
        return;
      }
      if (solBalance < 0.1) {
        alert('Insufficient SOL balance!');
        return;
      }
      try {
        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('devnet'));
        const transaction = new solanaWeb3.Transaction().add(
          solanaWeb3.SystemProgram.transfer({
            fromPubkey: new solanaWeb3.PublicKey(walletPublicKey),
            toPubkey: new solanaWeb3.PublicKey('YourGameWalletPublicKeyHere'), // Replace with actual game wallet
            lamports: 0.1 * solanaWeb3.LAMPORTS_PER_SOL
          })
        );
        const signature = await window.solana.signAndSendTransaction(transaction);
        await connection.confirmTransaction(signature);
        ticketCount += 1;
        solBalance -= 0.1;
        document.getElementById('tickets-owned').textContent = ticketCount;
        document.getElementById('sol-balance').textContent = solBalance.toFixed(4);
        alert('Ticket purchased! You’re in the 12.17 SOL draw!');
      } catch (err) {
        alert('Ticket purchase failed: ' + err.message);
      }
    }

    // Mock trade (buy/sell assets)
    function tradeAsset(action) {
      if (!walletConnected) {
        alert('Connect your Phantom wallet!');
        return;
      }
      const asset = Math.random() < 0.5 ? 'lotto' : Math.random() < 0.5 ? 'solusd' : 'memeindex';
      const price = asset === 'lotto' ? tokenPrice : asset === 'solusd' ? solUsdPrice / 100 : memeIndexPrice / 1000;
      if (action === 'buy') {
        portfolio[asset] += 1;
      } else if (portfolio[asset] > 0) {
        portfolio[asset] -= 1;
      }
      document.getElementById('portfolio-value').textContent = (
        portfolio.lotto * tokenPrice +
        portfolio.solusd * solUsdPrice / 100 +
        portfolio.memeindex * memeIndexPrice / 1000
      ).toFixed(4);
      alert(`${action.charAt(0).toUpperCase() + action.slice(1)} ${asset.toUpperCase()} (Mock)!`);
    }
  </script>
</body>
</html>
