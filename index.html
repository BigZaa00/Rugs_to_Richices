<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>$LOTTO: 12:17 Trading Rug Jamboree</title>
  <style>
    body {
      background: #1e222d;
      color: #d3d4d5;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    #login-screen {
      margin-top: 20vh;
      text-align: center;
    }
    #login-screen h1 {
      color: #00ff00;
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    #login-screen p {
      font-size: 1.2em;
      margin-bottom: 20px;
    }
    #game-screen {
      display: none;
      width: 100%;
      max-width: 1200px;
      margin: 20px;
      display: flex;
      flex-direction: row;
    }
    #chart-container {
      flex: 3;
      background: #252a3a;
      border-radius: 8px;
      padding: 10px;
      position: relative;
    }
    #ticker {
      background: #1a1e2a;
      padding: 8px;
      font-size: 1em;
      white-space: nowrap;
      overflow: hidden;
      animation: scroll 15s linear infinite;
      border-bottom: 1px solid #3a3f4f;
    }
    @keyframes scroll {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    #sidebar {
      flex: 1;
      background: #252a3a;
      border-radius: 8px;
      padding: 15px;
      margin-left: 10px;
      text-align: left;
    }
    #sidebar h2 {
      color: #00ff00;
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    #sidebar p {
      margin: 8px 0;
      font-size: 0.9em;
    }
    canvas {
      width: 100%;
      height: 300px;
      background: #1e222d;
    }
    button {
      background: #00ff00;
      color: #000;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
      margin: 5px 0;
      width: 100%;
    }
    button:hover {
      background: #00cc00;
    }
    .tooltip {
      position: absolute;
      background: #3a3f4f;
      color: #d3d4d5;
      padding: 5px;
      border-radius: 4px;
      font-size: 0.8em;
      display: none;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="login-screen">
    <h1>$LOTTO: 12:17 Trading Rug Jamboree</h1>
    <p>Connect your Phantom wallet to trade meme stocks and buy lottery tickets for the 12.17 SOL draw on June 21, 2026!</p>
    <button onclick="connectWallet()">Connect Phantom Wallet</button>
  </div>
  <div id="game-screen">
    <div id="chart-container">
      <div id="ticker">$LOTTO News: Buy tickets for the 12.17 SOL draw on June 21, 2026! | Prize Pool: 12.17 SOL</div>
      <canvas id="lotto-chart"></canvas>
      <canvas id="hypecorp-chart"></canvas>
      <canvas id="mooncoin-chart"></canvas>
      <div class="tooltip" id="tooltip"></div>
    </div>
    <div id="sidebar">
      <h2>$LOTTO Lottery</h2>
      <p>Next Draw: <span id="draw-date">June 21, 2026</span></p>
      <p>Ticket Price: <span id="ticket-price">0.1 SOL</span></p>
      <p>Prize Pool: <span id="prize-pool">12.17 SOL</span></p>
      <p>Tickets Owned: <span id="tickets-owned">0</span></p>
      <p>$LOTTO Price: <span id="token-price">0 SOL</span></p>
      <p>HypeCorp Price: <span id="hypecorp-price">0.01 SOL</span></p>
      <p>MoonCoin Price: <span id="mooncoin-price">0.005 SOL</span></p>
      <p>Wallet: <span id="wallet-address">Not connected</span></p>
      <p>SOL Balance: <span id="sol-balance">0</span></p>
      <button onclick="buyTicket()">Buy Lottery Ticket (0.1 SOL)</button>
      <a href="https://pump.fun" target="_blank"><button>Buy $LOTTO</button></a>
    </div>
  </div>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
  <script>
    let walletConnected = false;
    let walletPublicKey = null;
    let solBalance = 0;
    let prizePool = 12.17; // Fixed prize pool
    let ticketCount = 0; // Mock: track tickets off-chain
    let tokenPrice = 0.000001; // Mock: fetch from Pump.fun
    let hypeCorpPrice = 0.01; // Mock meme stock
    let moonCoinPrice = 0.005; // Mock meme stock
    let lottoHistory = Array(10).fill(0.000001); // Candlestick mock data
    let hypeCorpHistory = Array(10).fill(0.01);
    let moonCoinHistory = Array(10).fill(0.005);
    const DRAW_DATE = new Date('2026-06-21T00:00:00Z');
    const disasters = ['Hurricane', 'Earthquake', 'Tech Crash', 'Meme Dip'];
    let hypeCorpRugged = false;
    let moonCoinRugged = false;

    // Update ticker, charts, and narrative
    function updateTicker() {
      if (!walletConnected) return;
      const now = new Date();
      const timeLeft = DRAW_DATE - now;
      const daysLeft = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
      let tickerText = `$LOTTO News: ${daysLeft} days until 12.17 SOL draw on June 21, 2026! | Prize Pool: ${prizePool.toFixed(2)} SOL`;

      // Simulate rug pulls (5% chance per stock)
      if (!hypeCorpRugged && Math.random() < 0.05) {
        hypeCorpRugged = true;
        hypeCorpPrice = 0;
        tickerText = `RUG PULL: HypeCorp crashes to 0 SOL! $LOTTO draw secure! | Prize Pool: ${prizePool.toFixed(2)} SOL`;
      }
      if (!moonCoinRugged && Math.random() < 0.05) {
        moonCoinRugged = true;
        moonCoinPrice = 0;
        tickerText = `RUG PULL: MoonCoin crashes to 0 SOL! $LOTTO draw secure! | Prize Pool: ${prizePool.toFixed(2)} SOL`;
      }

      // Simulate AI-driven disasters (2% chance)
      if (Math.random() < 0.02) {
        const disaster = disasters[Math.floor(Math.random() * disasters.length)];
        tickerText = `DISASTER: ${disaster} hits market! Prize pool secure at ${prizePool.toFixed(2)} SOL!`;
      }

      // Update prices
      tokenPrice *= (1 + (Math.random() - 0.5) * 0.1);
      if (!hypeCorpRugged) hypeCorpPrice *= (1 + (Math.random() - 0.5) * 0.05);
      if (!moonCoinRugged) moonCoinPrice *= (1 + (Math.random() - 0.5) * 0.05);
      lottoHistory.push(tokenPrice);
      hypeCorpHistory.push(hypeCorpPrice);
      moonCoinHistory.push(moonCoinPrice);
      if (lottoHistory.length > 10) lottoHistory.shift();
      if (hypeCorpHistory.length > 10) hypeCorpHistory.shift();
      if (moonCoinHistory.length > 10) moonCoinHistory.shift();

      document.getElementById('ticker').textContent = tickerText;
      document.getElementById('draw-date').textContent = `June 21, 2026 (${daysLeft} days left)`;
      document.getElementById('prize-pool').textContent = `${prizePool.toFixed(2)} SOL`;
      document.getElementById('tickets-owned').textContent = ticketCount;
      document.getElementById('token-price').textContent = `${tokenPrice.toFixed(6)} SOL`;
      document.getElementById('hypecorp-price').textContent = `${hypeCorpPrice.toFixed(4)} SOL`;
      document.getElementById('mooncoin-price').textContent = `${moonCoinPrice.toFixed(4)} SOL`;

      drawCharts();
      setTimeout(updateTicker, 5000);
    }

    // Draw candlestick and line charts
    function drawCharts() {
      // $LOTTO Candlestick Chart
      const lottoCanvas = document.getElementById('lotto-chart');
      const lottoCtx = lottoCanvas.getContext('2d');
      lottoCtx.clearRect(0, 0, lottoCanvas.width, lottoCanvas.height);
      const maxLotto = Math.max(...lottoHistory, 0.000001);
      const minLotto = Math.min(...lottoHistory, 0.000001);
      const rangeLotto = maxLotto - minLotto;
      const candleWidth = lottoCanvas.width / (lottoHistory.length * 1.5);
      lottoHistory.forEach((price, i) => {
        const open = i > 0 ? lottoHistory[i - 1] : price;
        const close = price;
        const high = Math.max(open, close) * (1 + Math.random() * 0.02);
        const low = Math.min(open, close) * (1 - Math.random() * 0.02);
        const x = i * candleWidth * 1.5 + candleWidth / 2;
        const yHigh = ((maxLotto - high) / rangeLotto) * lottoCanvas.height;
        const yLow = ((maxLotto - low) / rangeLotto) * lottoCanvas.height;
        const yOpen = ((maxLotto - open) / rangeLotto) * lottoCanvas.height;
        const yClose = ((maxLotto - close) / rangeLotto) * lottoCanvas.height;
        lottoCtx.beginPath();
        lottoCtx.moveTo(x, yHigh);
        lottoCtx.lineTo(x, yLow);
        lottoCtx.strokeStyle = '#fff';
        lottoCtx.stroke();
        lottoCtx.fillStyle = close >= open ? '#00ff00' : '#ff0000';
        lottoCtx.fillRect(x - candleWidth / 2, Math.min(yOpen, yClose), candleWidth, Math.abs(yClose - yOpen));
      });

      // HypeCorp Line Chart
      const hypeCorpCanvas = document.getElementById('hypecorp-chart');
      const hypeCorpCtx = hypeCorpCanvas.getContext('2d');
      hypeCorpCtx.clearRect(0, 0, hypeCorpCanvas.width, hypeCorpCanvas.height);
      hypeCorpCtx.beginPath();
      const maxHypeCorp = Math.max(...hypeCorpHistory, 0.01);
      hypeCorpHistory.forEach((price, i) => {
        const x = i * (hypeCorpCanvas.width / (hypeCorpHistory.length - 1));
        const y = hypeCorpCanvas.height - (price / maxHypeCorp) * hypeCorpCanvas.height;
        if (i === 0) hypeCorpCtx.moveTo(x, y);
        else hypeCorpCtx.lineTo(x, y);
      });
      hypeCorpCtx.strokeStyle = '#00ff00';
      hypeCorpCtx.stroke();

      // MoonCoin Line Chart
      const moonCoinCanvas = document.getElementById('mooncoin-chart');
      const moonCoinCtx = moonCoinCanvas.getContext('2d');
      moonCoinCtx.clearRect(0, 0, moonCoinCanvas.width, moonCoinCanvas.height);
      moonCoinCtx.beginPath();
      const maxMoonCoin = Math.max(...moonCoinHistory, 0.005);
      moonCoinHistory.forEach((price, i) => {
        const x = i * (moonCoinCanvas.width / (moonCoinHistory.length - 1));
        const y = moonCoinCanvas.height - (price / maxMoonCoin) * moonCoinCanvas.height;
        if (i === 0) moonCoinCtx.moveTo(x, y);
        else moonCoinCtx.lineTo(x, y);
      });
      moonCoinCtx.strokeStyle = '#00ff00';
      moonCoinCtx.stroke();

      // Tooltip on hover
      [lottoCanvas, hypeCorpCanvas, moonCoinCanvas].forEach((canvas, index) => {
        canvas.onmousemove = (e) => {
          const tooltip = document.getElementById('tooltip');
          const rect = canvas.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const history = [lottoHistory, hypeCorpHistory, moonCoinHistory][index];
          const maxPrice = Math.max(...history);
          const indexAtX = Math.floor((x / canvas.width) * history.length);
          if (indexAtX >= 0 && indexAtX < history.length) {
            const price = history[indexAtX];
            tooltip.textContent = `Price: ${price.toFixed(6)} SOL`;
            tooltip.style.display = 'block';
            tooltip.style.left = `${e.clientX + 10}px`;
            tooltip.style.top = `${e.clientY + 10}px`;
          }
        };
        canvas.onmouseleave = () => {
          document.getElementById('tooltip').style.display = 'none';
        };
      });
    }

    // Connect Phantom wallet
    async function connectWallet() {
      if (window.solana && window.solana.isPhantom) {
        try {
          const response = await window.solana.connect();
          walletPublicKey = response.publicKey.toString();
          walletConnected = true;
          document.getElementById('wallet-address').textContent = walletPublicKey.slice(0, 4) + '...' + walletPublicKey.slice(-4);
          document.getElementById('login-screen').style.display = 'none';
          document.getElementById('game-screen').style.display = 'flex';
          await updateSolBalance();
          updateTicker();
        } catch (err) {
          alert('Connection failed: ' + err.message);
        }
      } else {
        alert('Please install the Phantom wallet!');
      }
    }

    // Update SOL balance
    async function updateSolBalance() {
      if (walletConnected) {
        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('devnet'));
        const publicKey = new solanaWeb3.PublicKey(walletPublicKey);
        const balance = await connection.getBalance(publicKey);
        solBalance = balance / solanaWeb3.LAMPORTS_PER_SOL;
        document.getElementById('sol-balance').textContent = solBalance.toFixed(4);
      }
    }

    // Buy lottery ticket (mock, actual transaction requires backend)
    async function buyTicket() {
      if (!walletConnected) {
        alert('Connect your Phantom wallet!');
        return;
      }
      if (solBalance < 0.1) {
        alert('Insufficient SOL balance!');
        return;
      }
      try {
        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('devnet'));
        const transaction = new solanaWeb3.Transaction().add(
          solanaWeb3.SystemProgram.transfer({
            fromPubkey: new solanaWeb3.PublicKey(walletPublicKey),
            toPubkey: new solanaWeb3.PublicKey('YourGameWalletPublicKeyHere'), // Replace with actual game wallet
            lamports: 0.1 * solanaWeb3.LAMPORTS_PER_SOL
          })
        );
        const signature = await window.solana.signAndSendTransaction(transaction);
        await connection.confirmTransaction(signature);
        ticketCount += 1; // Mock: track off-chain
        solBalance -= 0.1;
        document.getElementById('tickets-owned').textContent = ticketCount;
        document.getElementById('sol-balance').textContent = solBalance.toFixed(4);
        alert('Ticket purchased! You’re in the 12.17 SOL draw!');
      } catch (err) {
        alert('Ticket purchase failed: ' + err.message);
      }
    }
  </script>
</body>
</html>
